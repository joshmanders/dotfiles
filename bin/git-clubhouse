#! /usr/bin/env bash

function main () {
  local id="$1"
  local token=$(git config --get clubhouse.token)
  local story=$(curl -s "https://api.clubhouse.io/api/v1/stories/${id}?token=${token}")
  local type=$(echo "${story}" | jq -r '.story_type')
  local name=$(echo "${story}" | jq -r '.name')
  local string=$(echo "${name:0:25}" | sed -e 's/[[:space:]]*$//' | iconv -t ascii//TRANSLIT | sed -E s/[^a-zA-Z0-9]+/-/g | sed -E s/^-+\|-+$//g | tr A-Z a-z)

  git checkout -b "${type}/ch${id}/${string}"
}

main "$@"
